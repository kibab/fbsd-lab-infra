#!/bin/sh
set -eu
if [ -z $ARCH ]; then
   echo '$ARCH is not defined. Set to amd64|armv7|arm64. exiting'
   exit 1
fi

case $ARCH in
    amd64)
	ADD_ARGS=""
	;;
    arm64)
	ADD_ARGS="TARGET=arm64 TARGET_ARCH=aarch64"
	;;
    armv7)
	ADD_ARGS="ARCH=armv7 TARGET_ARCH=armv7"
	;;
esac

bdir=$1

SRCDIR=/freebsd-builder/freebsd-src
OBJDIR=/freebsd-builder/build
DESTDIR=/freebsd-builder/inst-${ARCH}
SOCMAKE=/freebsd-builder/fbsd-lab-infra/buildhost/bin/socmake

echo "cd $SRCDIR/$bdir && \$(ARCH=$ARCH $SOCMAKE buildenvvars) MAKEOBJDIRPREFIX=$OBJDIR make $ADD_ARGS"
