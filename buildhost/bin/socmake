#!/bin/sh
set -eu
if [ -z $ARCH ]; then
   echo '$ARCH is not defined. Set to amd64|armv7|arm64. exiting'
   exit 1
fi

case $ARCH in
    amd64)
	ADD_ARGS=""
	;;
    arm64)
	ADD_ARGS="TARGET=arm64 TARGET_ARCH=aarch64"
	;;
    armv7)
	ADD_ARGS="ARCH=armv7 TARGET_ARCH=armv7"
	;;
    armv6)
	ADD_ARGS="ARCH=armv6 TARGET_ARCH=armv6"
	;;
esac
export PROJROOT=/home/kibab/repos/fbsd-bbb
export MAKEOBJDIRPREFIX=$PROJROOT/obj-${ARCH}
export DESTDIR=$PROJROOT/inst-${ARCH}
export DISTDIR=${DESTDIR}

make -C $PROJROOT/freebsd __MAKE_CONF=$PROJROOT/make.conf SRCCONF=$PROJROOT/src.conf -C $PROJROOT/freebsd $ADD_ARGS $@
